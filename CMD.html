
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Colour-magnitude diagram &#8212; AIfA telescope data reduction tutorial</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'CMD';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Exoplanet transit light curve" href="lightcurve.html" />
    <link rel="prev" title="Photometry" href="photometry.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="AIfA telescope data reduction tutorial - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="AIfA telescope data reduction tutorial - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    AIfA telescope data reduction tutorial
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction and setup</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="background-info.html">Introduction to optical observations</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Requirements and installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview-pythontools.html">Structure and Python tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Setting up the data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic reduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pre-red.html">Image pre-reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="astrometry.html">Astrometric calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="photometry.html">Photometry</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Colour-magnitude diagram</a></li>
<li class="toctree-l1"><a class="reference internal" href="lightcurve.html">Exoplanet transit light curve</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Further content</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="stack.html">Reprojecting, stacking and colour-combination</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera-charact.html">Camera characterization</a></li>
<li class="toctree-l1"><a class="reference internal" href="more.html">References and links</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/aifatelescope/datared" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/aifatelescope/datared/issues/new?title=Issue%20on%20page%20%2FCMD.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/CMD.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Colour-magnitude diagram</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-and-structuring-the-data">Gathering and structuring the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-cmd-in-instrumental-magnitudes">A quick CMD in instrumental magnitudes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#magnitude-calibration">Magnitude calibration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matching-to-a-reference-catalogue">Matching to a reference catalogue</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-magnitude-zero-points">Computing the magnitude zero points</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isochrones">Isochrones</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-isochrones">Loading the isochrones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extinction-and-distance">Extinction and distance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-the-observed-cmd-with-isochrones">Comparing the observed CMD with isochrones</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-of-the-cmd">Discussion of the CMD</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="colour-magnitude-diagram">
<h1>Colour-magnitude diagram<a class="headerlink" href="#colour-magnitude-diagram" title="Link to this heading">#</a></h1>
<p>In this notebook, we will:</p>
<ul class="simple">
<li><p>read the photometric catalogs of the science frames and group them in a convenient structure,</p></li>
<li><p>calibrate the photometry by comparing our instrumental magnitudes to apparent magnitudes from a reference catalogue,</p></li>
<li><p>draw a colour-magnitude diagram (CMD),</p></li>
<li><p>and compare this CMD to isochrones from a stellar evolution code.</p></li>
</ul>
<p>You can download this page as a <a class="reference download internal" download="" href="_downloads/3319c70f21bb1195f87f5ce830ad416d/CMD.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code></a> file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case you have been working on an AIfA lab room computer until this point, you might be interested in moving to a personal laptop (for example) for these last steps.
All that we’ll need from here on is the content of the <code class="docutils literal notranslate"><span class="pre">PHOTOMETRY</span></code> directory (including the reference catalog). This is a relatively small amount of data (compared to the raw or pre-reduced images), so you could consider transferring just these files to your own computer. The CPU requirements for these last steps will also be negligible. Make sure to install the right python environment, following <a class="reference internal" href="installation.html"><span class="std std-doc">Requirements and installation</span></a>. There is no need for <code class="docutils literal notranslate"><span class="pre">astrometry.net</span></code> at this stage.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">dataredconfig</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.table</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.visualization</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.coordinates</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">astroquery.vizier</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>

<span class="o">%</span><span class="k">matplotlib</span> widget
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.widgets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>
</div>
</div>
</div>
<section id="gathering-and-structuring-the-data">
<h2>Gathering and structuring the data<a class="headerlink" href="#gathering-and-structuring-the-data" title="Link to this heading">#</a></h2>
<p>We start by reading the relevant catalogs as a list of tables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Where the photometry catalogs are:</span>
<span class="n">photometry_dir</span> <span class="o">=</span> <span class="n">dataredconfig</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">/</span> <span class="s2">&quot;PHOTOMETRY&quot;</span>

<span class="n">object_to_process</span> <span class="o">=</span> <span class="s2">&quot;M 37&quot;</span>

<span class="n">catalog_filepaths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">photometry_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.fits&#39;</span><span class="p">)))</span>
<span class="n">catalogs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">catalog_filepath</span> <span class="ow">in</span> <span class="n">catalog_filepaths</span><span class="p">:</span>
    
    <span class="n">catalog</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catalog_filepath</span><span class="p">)</span>

    <span class="c1"># We select the photometric catalogs of our object:  </span>
    <span class="k">if</span> <span class="s2">&quot;OBJECT&quot;</span> <span class="ow">in</span> <span class="n">catalog</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">catalog</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;OBJECT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">object_to_process</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">catalog_filepath</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">catalog</span><span class="o">.</span><span class="n">meta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">catalogs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">catalogs</span><span class="p">)</span><span class="si">}</span><span class="s2"> catalogs.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we “merge” all these separate tables into a particular structure that will make the analysis easier:</p>
<ul class="simple">
<li><p>Measurements done with the same filter are stacked in “depth”, i.e., grouped in 2D-columns.</p></li>
<li><p>Finally all filters are stacked “horizontally”, i.e., as separate columns in one single table.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filter_names</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">)</span>
<span class="n">filter_catalogs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">filter_name</span> <span class="ow">in</span> <span class="n">filter_names</span><span class="p">:</span>
    <span class="c1">#print(f&quot;Starting filter {filter_name}&quot;)</span>
    <span class="n">this_filter_catalogs</span> <span class="o">=</span> <span class="p">[</span><span class="n">catalog</span> <span class="k">for</span> <span class="n">catalog</span> <span class="ow">in</span> <span class="n">catalogs</span> <span class="k">if</span> <span class="n">catalog</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;FILTER&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">filter_name</span><span class="p">]</span>
    <span class="n">this_filter_catalog</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">this_filter_catalogs</span><span class="p">,</span> <span class="n">join_type</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="n">metadata_conflicts</span><span class="o">=</span><span class="s2">&quot;silent&quot;</span><span class="p">)</span>
    <span class="n">this_filter_catalog</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">filter_name</span>
    
    <span class="n">filter_catalogs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_filter_catalog</span><span class="p">)</span>

<span class="c1"># And we stack these catalogs horizontally into one single table:</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">filter_catalogs</span><span class="p">,</span>
        <span class="n">join_type</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="n">metadata_conflicts</span><span class="o">=</span><span class="s2">&quot;silent&quot;</span><span class="p">,</span>
        <span class="n">table_names</span><span class="o">=</span><span class="n">filter_names</span><span class="p">,</span> <span class="n">uniq_col_name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{col_name}</span><span class="s1">_</span><span class="si">{table_name}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

<span class="c1"># The columns are now the following:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns of cat:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">cat</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colname</span><span class="si">}</span><span class="s2">: shape </span><span class="si">{</span><span class="n">cat</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note how the filter name is now appended to the column names.
These columns have two dimension: the first index identifies the source (i.e., star), and the second index runs over the different exposures.</p>
<p>We now add two more columns: the sky position of each star, and while we are at it the separation between the star and the cluster center.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To get the position, we need to read the reference catalog:</span>
<span class="n">ref_catalog</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">photometry_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;ref_catalog_</span><span class="si">{</span><span class="n">object_to_process</span><span class="si">}</span><span class="s2">.fits&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref_catalog</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span> <span class="c1"># Just a check that these are indeed of same length</span>
    
<span class="n">cat</span><span class="p">[</span><span class="s2">&quot;sky_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_catalog</span><span class="p">[</span><span class="s2">&quot;sky_centroid_win&quot;</span><span class="p">]</span>
<span class="n">target_center_pos</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;RA&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">cat</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;DEC&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">cat</span><span class="p">[</span><span class="s2">&quot;separation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_center_pos</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s2">&quot;sky_pos&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<section id="a-quick-cmd-in-instrumental-magnitudes">
<h3>A quick CMD in instrumental magnitudes<a class="headerlink" href="#a-quick-cmd-in-instrumental-magnitudes" title="Link to this heading">#</a></h3>
<p>As an example about how the catalog can now be used, we compute a median instrumental magnitude in each filter (where the median is taken over the different exposures) and plot a simple uncalibrated CMD.
This quick magnitude computation is clearly not optimal, in particular if the atmospheric conditions changed during the observation! But it should be sufficient to get a first idea of the CMD. We’ll come back to magnitude calibration later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We take the median accross &quot;axis=1&quot;, that is the second index</span>
<span class="c1"># (the first index (axis=0) identifies the different stars).</span>
<span class="c1"># Note that the aperture radius of 4 arcsec is just used here as an example, other radii might perform better!</span>
<span class="n">cat</span><span class="p">[</span><span class="s2">&quot;quick_instr_mag_g&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s2">&quot;sum_4_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cat</span><span class="p">[</span><span class="s2">&quot;quick_instr_mag_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s2">&quot;sum_4_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cat</span><span class="p">[</span><span class="s2">&quot;quick_instr_mag_i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="s2">&quot;sum_4_i&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting a first CMD</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;quick_instr_mag_g&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;quick_instr_mag_i&quot;</span><span class="p">],</span>
    <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;quick_instr_mag_r&quot;</span><span class="p">],</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;separation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="c1"># color represents separation between star and cluster center</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Separation to target center in </span><span class="si">{</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;separation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Instrumental mag g - i&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Instrumental mag r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">object_to_process</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="magnitude-calibration">
<h2>Magnitude calibration<a class="headerlink" href="#magnitude-calibration" title="Link to this heading">#</a></h2>
<p>To compare our data with stellar models, we need to:</p>
<ul class="simple">
<li><p>convert our instrumental magnitudes into apparent magnitudes (that is, “standardise” our observations)</p></li>
<li><p>correct the absolute magnitudes of the stellar models by some appropriate distance and extinction, so that they can be compared to apparent magnitudes.</p></li>
</ul>
<p>In this section we will start by calibrating our magnitude measurements. We do this by matching some of the measured stars with a reference catalogue.</p>
<p>As a preparatory task, we compute instrumental magnitudes for each flux measurement, so that we can process each exposure individually.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computing instrumental magnitudes for all apertures and exposures:</span>
<span class="n">filter_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">]</span>
<span class="n">photometry_prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sum_4&quot;</span><span class="p">,</span> <span class="s2">&quot;sum_6&quot;</span><span class="p">,</span> <span class="s2">&quot;sum_8&quot;</span><span class="p">,</span> <span class="s2">&quot;sum_10&quot;</span><span class="p">]</span> <span class="c1"># if available, could add &quot;flux_fit&quot; as well</span>
<span class="k">for</span> <span class="n">filter_name</span> <span class="ow">in</span> <span class="n">filter_names</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">photometry_prefix</span> <span class="ow">in</span> <span class="n">photometry_prefixes</span><span class="p">:</span>
        <span class="n">cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;instr_mag_</span><span class="si">{</span><span class="n">photometry_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filter_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">photometry_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filter_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># Recall that these are 2D-columns with indices (source, exposure)</span>
</pre></div>
</div>
</div>
</div>
<section id="matching-to-a-reference-catalogue">
<h3>Matching to a reference catalogue<a class="headerlink" href="#matching-to-a-reference-catalogue" title="Link to this heading">#</a></h3>
<p>We will make use the catalogue ATLAS-REFCAT2. This is an all-sky reference catalog compiling together several large surveys. In particular, among many other data, it contains <em>real</em> photometry in the SDSS filters g, r, and i for stars brighter than the 14th magnitude. Details about the catalogue can be found at <a class="reference external" href="https://archive.stsci.edu/hlsp/atlas-refcat2">https://archive.stsci.edu/hlsp/atlas-refcat2</a> .</p>
<p>We access this catalogue via a service called VizieR, a library of published astronomical catalogues.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vizier</span> <span class="o">=</span>  <span class="n">astroquery</span><span class="o">.</span><span class="n">vizier</span><span class="o">.</span><span class="n">Vizier</span><span class="p">()</span>
<span class="n">vizier</span><span class="o">.</span><span class="n">ROW_LIMIT</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># just as a safety measure, 500 is more than enough</span>

<span class="n">catalogue_list</span> <span class="o">=</span> <span class="n">vizier</span><span class="o">.</span><span class="n">find_catalogs</span><span class="p">(</span><span class="s1">&#39;ATLAS-REFCAT2&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Identified catalogues:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">catalogue_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

<span class="n">ref_cat_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">catalogue_list</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loading the reference catalogue within 20 arcmin around the target, and down to mag 13:</span>
<span class="n">ref_cat</span> <span class="o">=</span> <span class="n">vizier</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span><span class="n">target_center_pos</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">arcmin</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">ref_cat_name</span><span class="p">,</span> <span class="n">column_filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rmag&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;13&#39;</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ref_cat</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ref_cat</span><span class="p">)</span>

<span class="c1"># If you obtain 500 stars (i.e., the ROW_LIMIT), decrease the depth of the request (see column_filters in the above).</span>
<span class="c1"># We really don&#39;t need more than a few stars, in fact!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matching our own catalogue with the reference catalogue</span>

<span class="c1"># The coordinates to match:</span>
<span class="n">ref_cat_coords</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">ref_cat</span><span class="p">[</span><span class="s2">&quot;RA_ICRS&quot;</span><span class="p">],</span> <span class="n">dec</span><span class="o">=</span><span class="n">ref_cat</span><span class="p">[</span><span class="s2">&quot;DE_ICRS&quot;</span><span class="p">])</span>
<span class="n">cat_coords</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;sky_pos&quot;</span><span class="p">]</span>

<span class="c1"># The matching itself is just one call:</span>
<span class="n">idx</span><span class="p">,</span> <span class="n">seps</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">match_coordinates_sky</span><span class="p">(</span><span class="n">cat_coords</span><span class="p">,</span> <span class="n">ref_cat_coords</span><span class="p">)</span>

<span class="c1"># This returns:</span>
<span class="c1"># idx: indices into ref_cat_coords to get the matched points for each cat_coords. Shape matches cat_coords.</span>
<span class="c1"># seps: on-sky separation between the closest match for each cat_coords and the cat_coords. Shape matches cat_coords.</span>

<span class="c1"># And assembling a combined matched catalogue:</span>
<span class="n">sep_constraint</span> <span class="o">=</span> <span class="n">seps</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span> <span class="c1"># criteria for a successful identification</span>
<span class="n">cat_matches</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="n">sep_constraint</span><span class="p">]</span>
<span class="n">ref_cat_matches</span> <span class="o">=</span> <span class="n">ref_cat</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">sep_constraint</span><span class="p">]]</span>

<span class="c1"># joining these two into one single matched catalogue:</span>
<span class="n">matched_cat</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">cat_matches</span><span class="p">,</span> <span class="n">ref_cat_matches</span><span class="p">],</span> <span class="n">join_type</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="n">metadata_conflicts</span><span class="o">=</span><span class="s2">&quot;silent&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Column names of matched catalogue:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">matched_cat</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of matched catalogue: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matched_cat</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can have a look at the histogram of separations between the matches, i.e., between the stars from the reference catalogue that are nearest to the sources from our own catalogue. The typical astrometric error should be much smaller than a pixel, if our astrometric calibration is good.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Histogram of separations:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">seps</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Separation in arcseconds&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histogram of on-sky separation between matches&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="computing-the-magnitude-zero-points">
<h3>Computing the magnitude zero points<a class="headerlink" href="#computing-the-magnitude-zero-points" title="Link to this heading">#</a></h3>
<p>Using the matched catalogue, we can visualize the difference between our own instrumental magnitudes and the apparent magnitudes from the reference catalogue.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp_to_show</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Showing data from the first exposure in each filter</span>
<span class="n">photom_prefix_to_show</span> <span class="o">=</span> <span class="s2">&quot;sum_4&quot;</span> <span class="c1"># Showing data for the 4-arcsec aperture</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">matched_cat</span><span class="p">[</span><span class="s2">&quot;rmag&quot;</span><span class="p">],</span> <span class="n">matched_cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;instr_mag_</span><span class="si">{</span><span class="n">photom_prefix_to_show</span><span class="si">}</span><span class="s2">_g&quot;</span><span class="p">][:,</span><span class="n">exp_to_show</span><span class="p">]</span> <span class="o">-</span> <span class="n">matched_cat</span><span class="p">[</span><span class="s2">&quot;gmag&quot;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">matched_cat</span><span class="p">[</span><span class="s2">&quot;rmag&quot;</span><span class="p">],</span> <span class="n">matched_cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;instr_mag_</span><span class="si">{</span><span class="n">photom_prefix_to_show</span><span class="si">}</span><span class="s2">_r&quot;</span><span class="p">][:,</span><span class="n">exp_to_show</span><span class="p">]</span> <span class="o">-</span> <span class="n">matched_cat</span><span class="p">[</span><span class="s2">&quot;rmag&quot;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">matched_cat</span><span class="p">[</span><span class="s2">&quot;rmag&quot;</span><span class="p">],</span> <span class="n">matched_cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;instr_mag_</span><span class="si">{</span><span class="n">photom_prefix_to_show</span><span class="si">}</span><span class="s2">_i&quot;</span><span class="p">][:,</span><span class="n">exp_to_show</span><span class="p">]</span> <span class="o">-</span> <span class="n">matched_cat</span><span class="p">[</span><span class="s2">&quot;imag&quot;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Apparent magnitude from reference catalogue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;instr_mag_</span><span class="si">{</span><span class="n">photom_prefix_to_show</span><span class="si">}</span><span class="s2"> - apparent mag&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>And now we compute and apply a zero point correction for each filter, exposure, and aperture size.
The zero points are computed using the matched catalogue, but then we apply them to our full catalogue, by adding new columns with calibrated apparent magnitudes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">filter_name</span> <span class="ow">in</span> <span class="n">filter_names</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">photometry_prefix</span> <span class="ow">in</span> <span class="n">photometry_prefixes</span><span class="p">:</span>
        
        <span class="c1"># We compute the zero point using the catalogue matched_cat.</span>
        <span class="c1"># The zero point is computed as the median (across all sources) of the mag differences plotted above.</span>
        <span class="c1"># For this we&#39;ll need to manually &quot;broadcast&quot; the reference magnitude columns, as they are 1D (i.e., they don&#39;t contain several &quot;exposures&quot;).</span>

        <span class="n">instr_mags</span> <span class="o">=</span> <span class="n">matched_cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;instr_mag_</span><span class="si">{</span><span class="n">photometry_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filter_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="c1"># This is 2D</span>
        <span class="n">ref_mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">matched_cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filter_name</span><span class="si">}</span><span class="s2">mag&quot;</span><span class="p">],</span> <span class="p">(</span><span class="n">instr_mags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="c1"># This is now also 2D, same shape as instr_mags</span>
        <span class="c1">#ref_mags = np.repeat(np.atleast_2d(matched_cat[f&quot;{filter_name}mag&quot;]), instr_mags.shape[1], axis=0).transpose() # Equivalent code, not much nicer</span>

        <span class="n">zeropoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">instr_mags</span> <span class="o">-</span> <span class="n">ref_mags</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Median taken accross the first index, i.e. the sources</span>
        <span class="c1"># This contains one zero point per exposure</span>

        <span class="c1"># And now we directly apply those zero points in the catalogue &quot;cat&quot;, creating a new column:</span>
        <span class="n">cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mag_</span><span class="si">{</span><span class="n">photometry_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filter_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;instr_mag_</span><span class="si">{</span><span class="n">photometry_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filter_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">zeropoints</span>

        <span class="c1"># To get one single magnitude per star, we compute the median (across exposures) of the calibrated magnitudes:</span>
        <span class="n">cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;median_mag_</span><span class="si">{</span><span class="n">photometry_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filter_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mag_</span><span class="si">{</span><span class="n">photometry_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">filter_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Note that this last step can certainly be improved and extended, one could compute several statistics at this stage.</span>
        <span class="c1"># The above is just meant to provide a simple and robust first solution to plot a CMD.</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s repeat the CMD plot with these new calibrated apparent magnitudes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The calibrated observational CMD</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;median_mag_sum_4_g&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;median_mag_sum_4_i&quot;</span><span class="p">],</span>
    <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;median_mag_sum_4_r&quot;</span><span class="p">],</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;separation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="c1"># color represents separation between star and cluster center</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Separation to target center in </span><span class="si">{</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;separation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;g - i&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">object_to_process</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="isochrones">
<h2>Isochrones<a class="headerlink" href="#isochrones" title="Link to this heading">#</a></h2>
<p>We will use isochrones (i.e. “synthetic” cluster CMDs) based on the stellar evolution code MESA, as provided by the <a class="reference external" href="https://waps.cfa.harvard.edu/MIST/">MIST</a> project (<a class="reference external" href="http://adsabs.harvard.edu/abs/2016ApJS..222....8D">Dotter 2016</a> and <a class="reference external" href="http://adsabs.harvard.edu/abs/2016ApJ...823..102C">Choi et al. 2016</a>). These isochrones have been generated with synthetic photometry computed in the same Sloan/SDSS photometric system that we use for our observations.
To make the use of these isochrones as easy as possible, we have repackaged them into a custom single file, that we will download and use below.</p>
<p>In case you want to know more about the origin of these isochrones, see the website of MIST (<a class="reference external" href="https://waps.cfa.harvard.edu/MIST/">https://waps.cfa.harvard.edu/MIST/</a>), the website of MESA (<a class="reference external" href="https://mesastar.org">https://mesastar.org</a>),  and the related publications.</p>
<p>The details about our repackaging into a single file are given <a class="reference internal" href="MIST_isochrone_repackaging.html"><span class="std std-doc">in this notebook</span></a>.</p>
<section id="loading-the-isochrones">
<h3>Loading the isochrones<a class="headerlink" href="#loading-the-isochrones" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the file containing all the isochrones (about 48 MB):</span>
<span class="n">isochrones_url</span> <span class="o">=</span> <span class="s2">&quot;https://uni-bonn.sciebo.de/s/czdMPjrLyi571uu/download&quot;</span>
<span class="n">local_isochrones_filepath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;isochrones_MIST.pickle&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">local_isochrones_filepath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">isochrones_url</span><span class="p">,</span> <span class="n">local_isochrones_filepath</span><span class="p">)</span>

<span class="c1"># Read this file with the following code (see below for explanations):</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_isochrones_filepath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="p">(</span><span class="n">isochrones</span><span class="p">,</span> <span class="n">vrots</span><span class="p">,</span> <span class="n">metallicities</span><span class="p">,</span> <span class="n">logages</span><span class="p">)</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The structure of this data needs a few explanations.</p>
<p>In practice, a single isochrone is stored as a 2D table: columns are absolute magnitudes in g, r, i, and rows correspond to different initial stellar masses. One can compute differences between these columns to obtain colors.</p>
<p>Obviously we need several isochrones. So we have such a table for several different ages, for several different metallicities, and for two stellar rotation velocities (more precisely: with or without rotation). Note that these isochrone tables don’t necessarily have the same size (i.e., the same resolution of initial masses).</p>
<p>The contents read by the code above are the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">isochrones</span></code> is a nested list (i.e., a list of lists of lists) of astropy Tables containing the isochrones.</p>
<ul>
<li><p>The <strong>first</strong> index of <code class="docutils literal notranslate"><span class="pre">isochrones</span></code> corresponds to the stellar rotation velocity,</p></li>
<li><p>the <strong>second</strong> index corresponds to metallicity, and</p></li>
<li><p>the <strong>third</strong> index corresponds to the age.</p></li>
<li><p>Then, the contained astropy tables have 4 columns, named <code class="docutils literal notranslate"><span class="pre">g</span></code>, <code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>, and <code class="docutils literal notranslate"><span class="pre">initial_mass</span></code>, where the photometry is given in absolute magnitudes, and the initial mass is given in solar masses.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vrots</span></code> is a 1D numpy array containing stellar rotation velocities (<strong>first</strong> index of <code class="docutils literal notranslate"><span class="pre">isochrones</span></code>). In fact, there are just two values: 0.0 means no rotation, and 0.4 means that the initial rotation velocity of higher mass stars is set to 0.4 times a critical surface velocity.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metallicities</span></code> is a 1D numpy array with the different available metallicities ([Fe/H]) of the isochrones, corresponding to the <strong>second</strong> index of <code class="docutils literal notranslate"><span class="pre">isochrones</span></code>. Recall that the metallicity of stars, i.e., the abundance of elements other than hydrogen and helium, has a significant influence on stellar evolution, and that we can assume that stars of a cluster share the same metallicity. Metallicity is often described by the logarithm of the iron-to-hydrogen ratio relative to that of the Sun, and denoted [Fe/H]. For example, [Fe/H] = 0 means that the stars have the same metallicity as the Sun, while [Fe/H] = -1.0 means that their metallictiy is one tenth that of the Sun.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logages</span></code> is a 1D numpy array containing the log10 of the available ages (in years) of the isochrones, corresponding to the <strong>third</strong> index of <code class="docutils literal notranslate"><span class="pre">isochrones</span></code>.</p></li>
</ul>
<p>The following plot demonstrates how to use the objects read from the isochrone file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Demonstrating the use of the isochrones with a simple non-interactive plot</span>

<span class="n">vrot_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">metallictiy_index</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">age_indices_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">age_index</span> <span class="ow">in</span> <span class="n">age_indices_to_plot</span><span class="p">:</span>

    <span class="n">age</span> <span class="o">=</span> <span class="mf">10.0</span><span class="o">**</span><span class="n">logages</span><span class="p">[</span><span class="n">age_index</span><span class="p">]</span>
    <span class="n">metallicity</span> <span class="o">=</span> <span class="n">metallicities</span><span class="p">[</span><span class="n">metallictiy_index</span><span class="p">]</span>
    <span class="n">vrot</span> <span class="o">=</span> <span class="n">vrots</span><span class="p">[</span><span class="n">vrot_index</span><span class="p">]</span>

    <span class="n">label_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">age</span><span class="o">/</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Gyr&quot;</span>

    <span class="c1"># And this is how to get one of the isochrones:</span>
    <span class="n">iso</span> <span class="o">=</span> <span class="n">isochrones</span><span class="p">[</span><span class="n">vrot_index</span><span class="p">][</span><span class="n">metallictiy_index</span><span class="p">][</span><span class="n">age_index</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iso</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">iso</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">],</span> <span class="n">iso</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label_string</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Absolute mag r - absolute mag i&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Absolute magnitude r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="extinction-and-distance">
<h3>Extinction and distance<a class="headerlink" href="#extinction-and-distance" title="Link to this heading">#</a></h3>
<p>To compare these isochrones to our calibrated data, we need two more ingredients: extinction, and distance.</p>
<p>Extinction is the radiation loss due to scattering and absorption by the interstellar medium (gas and dust). For a given line of sight, the amount of extinction depends on wavelength: blue light is scattered and absorbed more than red light, causing <em>reddening</em> of the light of stars. This dependency on wavelength is called a <em>reddening law</em>. Its shape depends on the properties of the interstellar medium, and is <em>not</em> the same for every cluster or part of the sky. The relation that we’ll use below is an empirical “average” solution, certainly only approximate, but it illustrates the idea.</p>
<p>Note that extinction is multiplicative in flux, and in practice it can therefore be expressed as a magnitude offset <span class="math notranslate nohighlight">\(A\)</span> for each band (assuming some spectrum for the starlight). These magnitude offsets in the different bands are proportional to each other. For a given reddening law, they can be expressed as multiples of the extinction in some reference band. In the example below, this reference is the visible band V, and the reference extinction is denoted <span class="math notranslate nohighlight">\(A_{\mathrm{V}}\)</span>. We will use it as a free parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extinction_law</span><span class="p">(</span><span class="n">A_V</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns extinction values for the different SDSS/Sloan filters, based on some reference total extinction A_V</span>

<span class="sd">    The particular values we use here are from Wang and Chen (2019) ApJ 877 116:</span>
<span class="sd">    https://iopscience.iop.org/article/10.3847/1538-4357/ab1c61</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#return {&quot;g&quot;: ref_ext*3.30, &quot;r&quot;: ref_ext*2.31, &quot;i&quot;:ref_ext*1.71 } # Table 2 of Yuan et al. (2013) https://doi.org/10.1093/mnras/stt039</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="n">A_V</span><span class="o">*</span><span class="mf">1.205</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">A_V</span><span class="o">*</span><span class="mf">0.848</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="n">A_V</span><span class="o">*</span><span class="mf">0.630</span> <span class="p">}</span> <span class="c1"># Table 3 of Wang and Chen (2019)</span>



<span class="k">def</span><span class="w"> </span><span class="nf">mag_absolute_to_apparent</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">extinction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that corrects absolute magnitudes by distance modulus and extinction, to get apparent magnitudes</span>
<span class="sd">    </span>
<span class="sd">    m: absolute magnitude(s)</span>
<span class="sd">    distance: in pc</span>
<span class="sd">    extinction: in mag</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">m</span> <span class="o">+</span> <span class="mf">5.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">extinction</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="comparing-the-observed-cmd-with-isochrones">
<h3>Comparing the observed CMD with isochrones<a class="headerlink" href="#comparing-the-observed-cmd-with-isochrones" title="Link to this heading">#</a></h3>
<p>With all this in hand, we will now build an interactive matplotlib plot, displaying the observed CMD, and overplotting isochrones of selected age and metallicity. For this we define one more helper function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_apparent_isochrone</span><span class="p">(</span><span class="n">vrot_index</span><span class="p">,</span> <span class="n">metallicity_index</span><span class="p">,</span> <span class="n">age_index</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">A_V</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to get a specific isochrone at a specific distance and total extinction</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Computing the extinctions:</span>
    <span class="n">extinctions</span> <span class="o">=</span> <span class="n">extinction_law</span><span class="p">(</span><span class="n">A_V</span><span class="p">)</span>
    
    <span class="c1"># Obtaining the corrected magnitudes:</span>
    <span class="n">iso_app_g</span> <span class="o">=</span> <span class="n">mag_absolute_to_apparent</span><span class="p">(</span><span class="n">isochrones</span><span class="p">[</span><span class="n">vrot_index</span><span class="p">][</span><span class="n">metallicity_index</span><span class="p">][</span><span class="n">age_index</span><span class="p">][</span><span class="s2">&quot;g&quot;</span><span class="p">],</span> <span class="n">distance</span><span class="p">,</span> <span class="n">extinctions</span><span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">])</span>
    <span class="n">iso_app_r</span> <span class="o">=</span> <span class="n">mag_absolute_to_apparent</span><span class="p">(</span><span class="n">isochrones</span><span class="p">[</span><span class="n">vrot_index</span><span class="p">][</span><span class="n">metallicity_index</span><span class="p">][</span><span class="n">age_index</span><span class="p">][</span><span class="s2">&quot;r&quot;</span><span class="p">],</span> <span class="n">distance</span><span class="p">,</span> <span class="n">extinctions</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">])</span>
    <span class="n">iso_app_i</span> <span class="o">=</span> <span class="n">mag_absolute_to_apparent</span><span class="p">(</span><span class="n">isochrones</span><span class="p">[</span><span class="n">vrot_index</span><span class="p">][</span><span class="n">metallicity_index</span><span class="p">][</span><span class="n">age_index</span><span class="p">][</span><span class="s2">&quot;i&quot;</span><span class="p">],</span> <span class="n">distance</span><span class="p">,</span> <span class="n">extinctions</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">])</span>
    
    <span class="c1"># A fancy string describing the isochrone, with some LaTeX formatting:</span>
    <span class="n">label_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Age </span><span class="si">{</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="n">logages</span><span class="p">[</span><span class="n">age_index</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">1e9</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Gyr, &quot;</span> \
        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;[Fe/H] = </span><span class="si">{</span><span class="n">metallicities</span><span class="p">[</span><span class="n">metallicity_index</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span> \
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$v/v_{\mathrm</span><span class="si">{crit}</span><span class="s2">}$ = &quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vrots</span><span class="p">[</span><span class="n">vrot_index</span><span class="p">]</span><span class="si">}</span><span class="s2">, &quot;</span> \
        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;$d$ = </span><span class="si">{</span><span class="n">distance</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> pc, &quot;</span> \
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$A_{\mathrm</span><span class="si">{V}</span><span class="s2">}$ = &quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">A_V</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">iso_app_g</span><span class="p">,</span> <span class="n">iso_app_r</span><span class="p">,</span> <span class="n">iso_app_i</span><span class="p">,</span> <span class="n">label_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And now the interactive plot, using matplotlib sliders.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this interactive plot, make sure to zoom to the relevant region, to properly see your data! You can do this either interactively, or by adapting the code for example via <code class="docutils literal notranslate"><span class="pre">ax.set_xlim([xmin,</span> <span class="pre">xmax])</span></code> and <code class="docutils literal notranslate"><span class="pre">ax.set_ylim([ymin,</span> <span class="pre">ymax])</span></code>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initial position of sliders:</span>
<span class="n">init_distance</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">init_age_index</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">init_metallicity_index</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">init_A_V</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">init_vrot_index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.30</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span> <span class="c1"># making room for the sliders</span>

<span class="c1"># Plotting the observed data </span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;median_mag_sum_4_r&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;median_mag_sum_4_i&quot;</span><span class="p">],</span>
    <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;median_mag_sum_4_r&quot;</span><span class="p">],</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;separation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="c1"># color represents separation between star and cluster center</span>
<span class="p">)</span>

<span class="c1"># Plotting the isochrone</span>
<span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">label_string</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_apparent_isochrone</span><span class="p">(</span><span class="n">init_vrot_index</span><span class="p">,</span> <span class="n">init_metallicity_index</span><span class="p">,</span> <span class="n">init_age_index</span><span class="p">,</span> <span class="n">init_distance</span><span class="p">,</span> <span class="n">init_A_V</span><span class="p">)</span>
<span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> 
<span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">label_string</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

<span class="c1"># The function to be called anytime a slider or botton is changed</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="n">vrot_index</span> <span class="o">=</span> <span class="n">vrot_button</span><span class="o">.</span><span class="n">index_selected</span>
    <span class="n">metallicity_index</span> <span class="o">=</span> <span class="n">metallicity_slider</span><span class="o">.</span><span class="n">val</span>
    <span class="n">age_index</span> <span class="o">=</span> <span class="n">age_slider</span><span class="o">.</span><span class="n">val</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">dist_slider</span><span class="o">.</span><span class="n">val</span>
    <span class="n">A_V</span> <span class="o">=</span> <span class="n">ext_slider</span><span class="o">.</span><span class="n">val</span>
    <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">label_string</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_apparent_isochrone</span><span class="p">(</span><span class="n">vrot_index</span><span class="p">,</span> <span class="n">metallicity_index</span><span class="p">,</span> <span class="n">age_index</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">A_V</span><span class="p">)</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">label_string</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

<span class="c1"># Slider to control the distance</span>
<span class="n">axdist</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0225</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="n">dist_slider</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axdist</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$d$ [pc]&quot;</span><span class="p">,</span>
    <span class="n">valmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">valmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">valinit</span><span class="o">=</span><span class="n">init_distance</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span>
<span class="p">)</span>

<span class="c1"># Slider to control the age</span>
<span class="n">axage</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0225</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="n">age_slider</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axage</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$i_{\mathrm</span><span class="si">{Age}</span><span class="s2">}$&quot;</span><span class="p">,</span>
    <span class="n">valmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">valmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">logages</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">valstep</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">valinit</span><span class="o">=</span><span class="n">init_age_index</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span>
<span class="p">)</span>

<span class="c1"># Slider to control the metallicity</span>
<span class="n">axmetal</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0225</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="n">metallicity_slider</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axmetal</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$i_{\mathrm{[Fe/H]}}$&quot;</span><span class="p">,</span>
    <span class="n">valmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">valmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metallicities</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">valstep</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">valinit</span><span class="o">=</span><span class="n">init_metallicity_index</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span>
<span class="p">)</span>

<span class="c1"># Slider to control the extinction</span>
<span class="n">axext</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0225</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="n">ext_slider</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axext</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$A_{\mathrm</span><span class="si">{V}</span><span class="s2">}$&quot;</span><span class="p">,</span>
    <span class="n">valmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">valmax</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
    <span class="n">valinit</span><span class="o">=</span><span class="n">init_A_V</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span>
<span class="p">)</span>

<span class="c1"># Radio buttons to control the rotation</span>
<span class="n">axvrot</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">])</span>
<span class="n">vrot_button</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axvrot</span><span class="p">,</span> 
    <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;No rotation&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$v/v_{\mathrm</span><span class="si">{crit}</span><span class="s2">} = 0.4$&quot;</span><span class="p">),</span>
    <span class="n">active</span><span class="o">=</span><span class="n">init_vrot_index</span>
<span class="p">)</span>

<span class="c1"># Register the update function with each slider and button:</span>
<span class="n">age_slider</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
<span class="n">dist_slider</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
<span class="n">metallicity_slider</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
<span class="n">ext_slider</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
<span class="n">vrot_button</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>

<span class="c1"># Finalize plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cbar</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Separation to target center in </span><span class="si">{</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;separation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$r$ - $i$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$r$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">object_to_process</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="discussion-of-the-cmd">
<h2>Discussion of the CMD<a class="headerlink" href="#discussion-of-the-cmd" title="Link to this heading">#</a></h2>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>What photometric aperture radius gives the most accurate CMD? Apart from judging the appearance of the CMD itself, feel invited to make and discuss dedicated plots (e.g., similar to the one done just before the zero point computations above). Especially if the observing conditions were variable, it might be interesting to analyse if and how individual exposures differ, instead of just considering their median.</p>
</div>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>Optionally, and somewhat related to the previous question, you could compute uncertainty estimates for your magnitude measurements, and visualize those on the CMD. There are several different approaches to compute these. If you chose to do so, make sure to describe precisely how you computed these error bars, and discuss what sources of uncertainty they represent.</p>
</div>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>What features do you see in the observed CMD? Describe your data.</p>
</div>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>By comparing the calibrated CMD to the synthetic isochrones, give an estimate of the age and distance of your cluster, and potentially also of the metallicity and extinction. Potentially, you can discuss how some features of your CMD help in constraining these parameters.</p>
</div>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>Discuss the difficulty to get estimates (and uncertainty estimates) for these parameters. You could create CMDs with several isochrones to illustrate your points.
If you would have to quantify uncertainties, how could you approach this?</p>
</div>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>Provide a comparison with values from the literature (at least for distance and age).</p>
</div>
<div class="admonition-question admonition">
<p class="admonition-title">Question</p>
<p>Try to list the ingredients of this whole analysis that could possibly have issues. In other words, what do you think are the key assumptions of your analysis?</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="photometry.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Photometry</p>
      </div>
    </a>
    <a class="right-next"
       href="lightcurve.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Exoplanet transit light curve</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-and-structuring-the-data">Gathering and structuring the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-cmd-in-instrumental-magnitudes">A quick CMD in instrumental magnitudes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#magnitude-calibration">Magnitude calibration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matching-to-a-reference-catalogue">Matching to a reference catalogue</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-magnitude-zero-points">Computing the magnitude zero points</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isochrones">Isochrones</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-isochrones">Loading the isochrones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extinction-and-distance">Extinction and distance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-the-observed-cmd-with-isochrones">Comparing the observed CMD with isochrones</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-of-the-cmd">Discussion of the CMD</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the AIfA telescope team / Malte Tewes
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
All contents released under <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>, unless specified otherwise.<br>
<a href="https://astro.uni-bonn.de/de/institut/impressum" target="_blank">Impressum</a>
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>